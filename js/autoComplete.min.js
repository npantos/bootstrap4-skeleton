!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?module.exports=factory():"function"==typeof define&&define.amd?define(factory):global.autoComplete=factory()}(this,function(){"use strict";function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}var select_resultsList="autoComplete_list",select_result="autoComplete_result",select_highlight="autoComplete_highlighted",select_selectedResult="autoComplete_selected",clearResults=function(resultsList){return resultsList.innerHTML=""},onSelection=function(event,field,resultsList,feedback,resultsValues,selection){feedback({event:event,query:field instanceof HTMLInputElement?field.value:field.innerHTML,matches:resultsValues.matches,results:resultsValues.list.map(function(record){return record.value}),selection:resultsValues.list.find(function(value){return 13===event.keyCode?value.index===Number(selection.getAttribute("data-id")):"mousedown"===event.type?value.index===Number(event.target.getAttribute("data-id")):void 0})}),clearResults(resultsList)},autoCompleteView={getInput:function(selector){return"string"==typeof selector?document.querySelector(selector):selector()},createResultsList:function(renderResults){var resultsList=document.createElement(renderResults.element);return resultsList.setAttribute("id",select_resultsList),renderResults.container&&renderResults.container(resultsList),renderResults.destination.insertAdjacentElement(renderResults.position,resultsList),resultsList},highlight:function(value){return"<span class=".concat(select_highlight,">").concat(value,"</span>")},addResultsToList:function(resultsList,dataSrc,resultItem){dataSrc.forEach(function(event,record){var result=document.createElement(resultItem.element),resultIndex=dataSrc[record].index;result.setAttribute("data-id",resultIndex),result.setAttribute("class",select_result),resultItem.content?resultItem.content(event,result):result.innerHTML=event.match||event,resultsList.appendChild(result)})},navigation:function(input,resultsList,feedback,resultsValues){var next,li=resultsList.childNodes,liLength=li.length-1,liSelected=void 0,removeSelection=function(direction){liSelected.classList.remove(select_selectedResult),next=1===direction?liSelected.nextSibling:liSelected.previousSibling},highlightSelection=function(current){(liSelected=current).classList.add(select_selectedResult)};input.onkeydown=function(event){if(li.length>0)switch(event.keyCode){case 38:liSelected?(removeSelection(0),highlightSelection(next||li[liLength])):highlightSelection(li[liLength]);break;case 40:liSelected?(removeSelection(1),highlightSelection(next||li[0])):highlightSelection(li[0]);break;case 13:liSelected&&onSelection(event,input,resultsList,feedback,resultsValues,liSelected)}},li.forEach(function(selection){selection.onmousedown=function(event){return onSelection(event,input,resultsList,feedback,resultsValues)}})},clearResults:clearResults},CustomEventPolyfill=function(event,params){params=params||{bubbles:!1,cancelable:!1,detail:void 0};var evt=document.createEvent("CustomEvent");return evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt};CustomEventPolyfill.prototype=window.Event.prototype;var Polyfill={CustomEventWrapper:"function"==typeof window.CustomEvent&&window.CustomEvent||CustomEventPolyfill,initElementClosestPolyfill:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(s){var el=this;do{if(el.matches(s))return el;el=el.parentElement||el.parentNode}while(null!==el&&1===el.nodeType);return null})}};return function(){function autoComplete(config){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,autoComplete),this.selector=config.selector||"#autoComplete",this.data={src:function(){return"function"==typeof config.data.src?config.data.src():config.data.src},key:config.data.key,cache:void 0===config.data.cache||config.data.cache},this.query=config.query,this.trigger={event:config.trigger&&config.trigger.event?config.trigger.event:["input"],condition:!(!config.trigger||!config.trigger.condition)&&config.trigger.condition},this.searchEngine="loose"===config.searchEngine?"loose":"function"==typeof config.searchEngine?config.searchEngine:"strict",this.threshold=config.threshold||0,this.debounce=config.debounce||0,this.resultsList={render:!(!config.resultsList||!config.resultsList.render)&&config.resultsList.render,view:config.resultsList&&config.resultsList.render?autoCompleteView.createResultsList({container:!(!config.resultsList||!config.resultsList.container)&&config.resultsList.container,destination:config.resultsList&&config.resultsList.destination?config.resultsList.destination:autoCompleteView.getInput(this.selector),position:config.resultsList&&config.resultsList.position?config.resultsList.position:"afterend",element:config.resultsList&&config.resultsList.element?config.resultsList.element:"ul"}):null,navigation:!(!config.resultsList||!config.resultsList.navigation)&&config.resultsList.navigation},this.sort=config.sort||!1,this.placeHolder=config.placeHolder,this.maxResults=config.maxResults||5,this.resultItem={content:!(!config.resultItem||!config.resultItem.content)&&config.resultItem.content,element:config.resultItem&&config.resultItem.element?config.resultItem.element:"li"},this.noResults=config.noResults,this.highlight=config.highlight||!1,this.onSelection=config.onSelection,this.init()}var Constructor,protoProps,staticProps;return Constructor=autoComplete,(protoProps=[{key:"search",value:function(query,record){var recordLowerCase=record.toLowerCase();if("loose"===this.searchEngine){query=query.replace(/ /g,"");for(var match=[],searchPosition=0,number=0;number<recordLowerCase.length;number++){var recordChar=record[number];searchPosition<query.length&&recordLowerCase[number]===query[searchPosition]&&(recordChar=this.highlight?autoCompleteView.highlight(recordChar):recordChar,searchPosition++),match.push(recordChar)}return searchPosition===query.length&&match.join("")}if(recordLowerCase.includes(query))return query=new RegExp("".concat(query),"i").exec(record),this.highlight?record.replace(query,autoCompleteView.highlight(query)):record}},{key:"listMatchedResults",value:function(data){var _this=this;return new Promise(function(resolve){var resList=[];data.filter(function(record,index){var search=function(key){var recordValue=key?record[key]:record,match="function"==typeof _this.searchEngine?_this.searchEngine(_this.queryValue,recordValue):_this.search(_this.queryValue,recordValue);match&&key?resList.push({key:key,index:index,match:match,value:record}):match&&!key&&resList.push({index:index,match:match,value:record})};if(_this.data.key){var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_this.data.key[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){search(_step.value)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{_iteratorNormalCompletion||null==_iterator.return||_iterator.return()}finally{if(_didIteratorError)throw _iteratorError}}}else search()});var list=_this.sort?resList.sort(_this.sort).slice(0,_this.maxResults):resList.slice(0,_this.maxResults);return resolve({matches:resList.length,list:list})})}},{key:"ignite",value:function(){var _this2=this,input=autoCompleteView.getInput(this.selector);this.placeHolder&&input.setAttribute("placeholder",this.placeHolder);var run=function(event){Promise.resolve(_this2.data.cache?_this2.dataStream:_this2.data.src()).then(function(data){_this2.dataStream=data,function(event){var inputValue=input instanceof HTMLInputElement?input.value.toLowerCase():input.innerHTML.toLowerCase(),queryValue=_this2.queryValue=_this2.query&&_this2.query.manipulate?_this2.query.manipulate(inputValue):inputValue,renderResultsList=_this2.resultsList.render,triggerCondition=_this2.trigger.condition?_this2.trigger.condition(queryValue):queryValue.length>_this2.threshold&&queryValue.replace(/ /g,"").length,eventEmitter=function(event,results){input.dispatchEvent(new Polyfill.CustomEventWrapper("autoComplete",{bubbles:!0,detail:{event:event,input:inputValue,query:queryValue,matches:results?results.matches:null,results:results?results.list:null},cancelable:!0}))};if(renderResultsList){var resultsList=_this2.resultsList.view;autoCompleteView.clearResults(resultsList),triggerCondition?_this2.listMatchedResults(_this2.dataStream,event).then(function(list){eventEmitter(event,list),_this2.resultsList.render&&(0===list.list.length&&_this2.noResults?_this2.noResults():(autoCompleteView.addResultsToList(resultsList,list.list,_this2.resultItem),_this2.onSelection&&(_this2.resultsList.navigation?_this2.resultsList.navigation(event,input,resultsList,_this2.onSelection,list):autoCompleteView.navigation(input,resultsList,_this2.onSelection,list))))}):eventEmitter(event)}else!renderResultsList&&triggerCondition&&_this2.listMatchedResults(_this2.dataStream,event).then(function(list){eventEmitter(event,list)})}(event)})};this.trigger.event.forEach(function(eventType){var func,delay,inDebounce;input.addEventListener(eventType,(func=function(event){return run(event)},delay=_this2.debounce,function(){var context=this,args=arguments;clearTimeout(inDebounce),inDebounce=setTimeout(function(){return func.apply(context,args)},delay)}))})}},{key:"init",value:function(){var _this3=this;this.data.cache?Promise.resolve(this.data.src()).then(function(data){_this3.dataStream=data,_this3.ignite()}):this.ignite(),Polyfill.initElementClosestPolyfill()}}])&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),autoComplete}()});